/* Return the list of indexes in the databases */

var fs = require('fs');
var lgarr=require('../languages').temparray;
var sqlite3 = require("sqlite3").verbose();
var filepath=require("path").resolve(__dirname,'../../../','assets/db/characters.db');

//var filepath =__dirname + "/../../../assets/db/characters.db";

//var tablesnames=[lg.tw.tablename,lg.cn.tablename,lg.jp.tablename];

var exists = fs.existsSync(filepath);

var getIndexFromDb = function(callback) {
    /* Counting the number of querys/results */
    var index=0;
    
    /*Record the indexes array */
    var indexesarr={};
    
    if (!exists) {
        callback('Could not find database', null);
    }
    else {
        var db = new sqlite3.Database(filepath);

        db.parallelize(function() {
            lgarr.forEach(function(lg) {
                lg.indexes = [];
                db.each('SELECT _id FROM ' + lg.tablename, function(error, row) {
                    if (error) {
                        console.log(error);
                    }
                    else {
                        lg.indexes.push(row._id);
                    }
                }, function(err, number) {
                    indexesarr[lg.name]=lg.indexes;
                    index++;
                    if (err) {
                        callback(err, null);
                    }
                    else {
                        if (index == 3) {
                            callback(null, indexesarr);
                        }
                    }
                });
            });
        });

        db.close();
    }
};


module.exports=function(callback) {
        if (typeof(callback) == 'function') {
            getIndexFromDb(callback);
        }
    };
            
    
    
// function(calling_language,callback){
//     var langarray=calling_language.indexes;
//     if (langarray){
//         /* Get a random element in the array index */
//         var myindex= langarray[Math.floor(Math.random()*langarray.length)];
//         callback(myindex);
//     }
//     else{
//         getRandomNumber(calling_language.name,function(index){
//             callback(index);
//         });
//     }

// };
    
    

// /* Function returning q random number depending on the calling language */
// function getRandomNumber(calling_language,callback){

//     var mynumber;
    
//     switch (calling_language) {
        
//     case 'Cmain':
//         mynumber = Math.floor(Math.random() * (1100 - 1000) + 1000);
//         break;
//     case 'Ctw':
//         mynumber = Math.floor(Math.random() * (1100 - 1000) + 1000);
//         break;
//     case 'Cjp':
//         mynumber = Math.floor(Math.random() * (1100 - 1000) + 1000);
//         break;
//     default:
//         mynumber = 1;
//         break;
//     }    

//     callback(mynumber);
// }
    
